#!/usr/bin/env bash
set -euo pipefail

PROJECT=${PROJECT:-${WORKSPACE}}
CONTEXT=${CONTEXT:-${PROJECT}}

echo "➜  \`step\` - committing modifications within: '${CONTEXT}'"
echo "➜  ..."

git add ${CONTEXT}

if [[ "$@" == "" ]] ; then
  journal=$(
    git diff --staged -- doc/JOURNAL.md \
    | grep -e '^\+' \
    | grep -v '+++' \
    | sed 's/^\+//g'
  )
  echo "➜  with journal:"
  message="step ➜

$journal
"

  echo "$message"
  git duet-commit -m "$message"
else
  git duet-commit "$@"
fi
